---
import { useSanityClient } from 'astro-sanity';
import { Image } from 'astro:assets';
import { getFirstBlogPost, urlForImage } from '../../lib/api.js';
import Main from '../../components/MainBlog.astro';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
  const posts = await useSanityClient().fetch(`*[_type == "funtazia"]`);
  /*   console.log(posts); */
  return posts.map(
    ({ slug, content, headline, image, imagesGallery, imagesTest }) => {
      return {
        params: { slug: slug.current },
        props: { content, headline, image, imagesGallery, imagesTest },
      };
    }
  );
}

const { slug } = Astro.params;
console.log(slug);
const { headline, content, image, imagesGallery, imagesTest } = Astro.props;
---

<Layout>
  <Main>
    <!--  <div class="w-[500px] m-auto">
      <a data-fslightbox="gallery" href="https://i.imgur.com/fsyrScY.jpg">
        <img src="https://i.imgur.com/fsyrScY.jpg" alt="Image" />
      </a>
    </div> -->
    <img
      class="w-screen"
      src={image ? urlForImage(image).format('webp') : ''}
    />
    <section class="w-full relative bottom-[300px]">
      <div
        class="absolute grid max-w-screen w-10/12 lg:w-6/12 left-1/2 transform -translate-x-1/2 top-[-100px] md:top-[-200px] lg:top-[-300px] xl:top-[-450px]"
      >
        <div class="bg-secondaryColor z-index-2 transition-all">
          <h1 class="text-amber text-4xl p-8">{headline}</h1>
          <p>Gábor - <span>2024-05-13</span></p>
          <p class="px-12 mb-12 text-xl font-judson">{content}</p>
        </div>
      </div>
      <div></div>
    </section>
    <section class="p-1 m-20 border-4 border-white top-16 bg-primaryColor">
      <h2 class="text-6xl p-5 text-secondaryColor text-center">Galéria</h2>
      <div id="gallery" class="flex p-5">
        {
          imagesGallery.map((kep) => (
            <>
              <div class="">
                <a
                  href={urlForImage(kep).format('jpg')}
                  data-fslightbox="gallery"
                >
                  <img
                    class="h-[300px] w-auto p-5"
                    src={urlForImage(kep).format('jpg')}
                    alt="Image"
                  />
                </a>
              </div>
            </>
          ))
        }
      </div>
    </section>
    <div class="bg-black flex justify-center">
      {
        imagesTest.map((obj) => (
          <>
            {console.log(obj)}
            <p>{obj.alt}</p>
            <img
              src={urlForImage(obj.image).format('jpg')}
              class="w-[200px] h-auto"
            />
          </>
        ))
      }
    </div>
  </Main>
</Layout>

<script>
  import fslightbox from 'fslightbox';
  fsLightbox.props.type = 'image';
</script>
